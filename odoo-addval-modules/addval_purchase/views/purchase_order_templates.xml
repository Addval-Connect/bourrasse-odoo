<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="purchase_informations" inherit_id="addval_accounting.invoice_data" priority="21" primary="True">
        <xpath expr="//t[@id='references']" position="replace"/>
    </template>
    <template id="transferable_table" inherit_id="addval_accounting.transferable_table" priority="21" primary="True">
        <div name="transferable-table" position="attributes">
            <attribute name="class">col-6</attribute>
        </div>
    </template>

    <template id="report_purchaseorder_document" inherit_id="purchase.report_purchaseorder_document" priority="20">
        <t t-set="address" position="replace"/>
        <xpath expr="//t[@t-set='information_block']/.." position="replace"/>
        <xpath expr="//t[@t-else='']" position="replace"/>
        <t t-set="o" position="after">
            <t t-set="header_data" t-value="o.get_header_data()"/>
            <t t-set="custom_header" t-value="'addval_accounting.custom_header'"/>
        </t>
        <xpath expr="//div[@class='page']/h2[3]" position="replace"/>
        <xpath expr="//div[@class='page']/h2[2]" position="replace"/>
        <xpath expr="//div[@class='page']/h2[1]" position="replace"/>
        <div class="oe_structure" position="replace"/>
        <div id="informations" position="replace">
            <t t-set="invoice_data" t-value="o.get_invoice_data()"/>
            <t t-call="addval_purchase.purchase_informations"/>
        </div>
        <xpath expr="//table[@class='table table-sm o_main_table']" position="attributes">
            <attribute name="class">table table-sm o_main_table small</attribute>
        </xpath>
        <th name="th_date_req" position="replace"/>
        <xpath expr="//span[@t-field='line.date_planned']/.." position="replace"/>
        <xpath expr="//td[@class='text-right']/span" position="attributes">
            <attribute name="class">text-nowrap</attribute>
        </xpath>
        <xpath expr="//td[@name='td_taxes']" position="replace"/>
        <xpath expr="//span[@t-field='line.price_unit']/.." position="after">
            <td name="td_taxes">
                <span t-esc="', '.join(map(lambda x: '{:.2f}%'.format(x.amount), line.taxes_id))"/>
            </td>
        </xpath>
        <xpath expr="//span[@t-field='line.price_unit']" position="attributes">
            <attribute name="t-field"></attribute>
            <attribute name="t-esc">line.price_unit</attribute>
            <attribute name="t-options">{"widget": "monetary", "display_currency": o.currency_id}</attribute>
        </xpath>
        <th name="th_taxes" position="replace"/>
        <xpath expr="//th[@name='th_price_unit']" position="after">
            <th name="th_taxes"><strong>Taxes</strong></th>
        </xpath>
        <p t-field="o.notes" position="replace"/>
        <xpath expr="//div[@id='total']" position="attributes">
            <attribute name="class">row mr-1</attribute>
        </xpath>
        <xpath expr="//div[@id='total']/div" position="attributes">
            <attribute name="class">col-6</attribute>
        </xpath>
        <xpath expr="//div[@id='total']/div" position="before">
            <t t-call="addval_accounting.notes"/>
        </xpath>
        <div class="oe_structure" position="before">
             <t t-call="addval_accounting.important_notes"/>
        </div>
    </template>
</odoo>